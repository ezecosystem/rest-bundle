<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>

        <service id="xrowsso.platform.user.manager" class="Doctrine\ORM\EntityManager"
                 factory-service="doctrine" factory-method="getManagerForClass">
            <argument>xrow\restBundle\Entity\User</argument>
        </service>

        <service id="xrowsso.platform.user.repository" class="xrow\restBundle\Repository\UserRepository"
                 factory-service="xrowsso.platform.user.manager" factory-method="getRepository">
            <argument>xrow\restBundle\Entity\User</argument>
        </service>

        <service id="xrow_rest.loadcrm.plugin" class="xrow\restBundle\CRM\LoadCRMPlugin">
            <argument type="service" id="service_container" /> 
        </service>

        <service id="xrowsso.platform.user.provider" class="xrow\restBundle\Provider\UserProvider">
            <argument type="service" id="xrowsso.platform.user.repository" />
            <argument type="service" id="xrow_rest.loadcrm.plugin" />
        </service>

        <service id="xrow_rest.controller.api" class="xrow\restBundle\Controller\ApiController" />

        <service id="xrow_oauth_server.storage" class="xrow\restBundle\Storage\OAuthStorage" public="false">
            <argument type="service" id="fos_oauth_server.client_manager" />
            <argument type="service" id="fos_oauth_server.access_token_manager" />
            <argument type="service" id="fos_oauth_server.refresh_token_manager" />
            <argument type="service" id="fos_oauth_server.auth_code_manager" />
            <argument type="service" id="fos_oauth_server.user_provider" on-invalid="null" />
            <argument type="service" id="security.encoder_factory" />
        </service>

    </services>

</container>